<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¹èœå•ç¨‹åº</title>
    <style>
        /* (CSS æ ·å¼éƒ¨åˆ† - ä¿æŒä¸å˜) */
        body { margin: 0; font-family: Arial, sans-serif; background-color: #f4f4f4; padding-bottom: 60px; }
        .top-nav { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 10px; 
            background-color: #f08080; 
            color: white; 
            position: fixed; 
            width: 100%; 
            top: 0; 
            box-sizing: border-box; 
            z-index: 10; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); 
        }
        .right-buttons {
            display: flex;
            gap: 5px; /* ç¨å¾®ç¼©å°é—´è·ä»¥å®¹çº³æ›´å¤šæŒ‰é’® */
        }
        .top-nav button { 
            background-color: #d85050; 
            color: white; 
            border: none; 
            padding: 8px 10px; /* è°ƒæ•´ padding é€‚åº”æ›´å¤šæŒ‰é’® */
            border-radius: 5px; 
            font-size: 14px; 
            cursor: pointer; 
            transition: opacity 0.2s; 
            white-space: nowrap; /* ç¡®ä¿æ–‡å­—ä¸æ¢è¡Œ */
        }
        .category-header { background-color: #fcc9c9; color: #d85050; padding: 15px; margin-top: 60px; font-weight: bold; font-size: 16px; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; background-color: white; padding: 15px 10px; border-bottom: 1px solid #eee; }
        .item-info .name { font-size: 16px; font-weight: bold; margin-bottom: 5px; }
        .item-info .price { font-size: 14px; color: #666; }
        .quantity-control { display: flex; align-items: center; }
        .control-btn { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #f08080; background-color: white; color: #f08080; font-size: 20px; line-height: 28px; text-align: center; cursor: pointer; padding: 0; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
        .control-btn.add { background-color: #f08080; color: white; border: none; }
        .quantity { margin: 0 10px; width: 20px; text-align: center; font-size: 16px; font-weight: bold; }
        .quantity-control.hidden .minus-btn, .quantity-control.hidden .quantity { visibility: hidden; }
        .bottom-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background-color: #f08080; color: white; position: fixed; width: 100%; bottom: 0; box-sizing: border-box; box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1); }
        .total-display { font-size: 18px; font-weight: bold; }
        .view-order-btn { background-color: #ffc107; color: #333; border: none; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 14px; cursor: pointer; }
        .modal { display: none; position: fixed; z-index: 20; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; padding: 20px; border-radius: 10px; width: 80%; max-width: 400px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); text-align: center; }
        .modal-content h2 { color: #d85050; margin-top: 0; }
        .table-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .table-number-btn { padding: 15px 10px; background-color: #eee; border: 1px solid #ccc; border-radius: 5px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .table-number-btn.occupied { background-color: #4CAF50; color: white; border-color: #45a049; }
        .table-number-btn.selected { background-color: #f08080; color: white; border-color: #d85050; }
        .table-number-btn.selected.occupied { background-color: #f08080; border-color: #d85050; }
        .close-btn { background-color: #d85050; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .order-modal-content { background-color: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); text-align: left; }
        .order-header { text-align: center; margin-bottom: 10px; }
        .order-title { font-size: 20px; font-weight: bold; color: #333; }
        .order-hr { border: none; height: 1px; background-color: #ffb6c1; margin: 15px 0; }
        .order-content { min-height: 100px; max-height: 300px; overflow-y: auto; padding: 5px 0; }
        .no-order-text { text-align: center; color: #666; margin: 40px 0; }
        .order-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #eee; }
        .item-name-qty { font-size: 16px; }
        .item-subtotal { font-weight: bold; color: #d85050; }
        .order-total-display { text-align: right; font-size: 22px; font-weight: bold; color: #d85050; margin: 15px 0; }
        .order-actions { display: flex; justify-content: space-between; gap: 10px; margin-top: 15px; }
        .clear-order-btn { flex: 1; padding: 15px; background-color: #d85050; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .checkout-order-btn { flex: 1; padding: 15px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .checkout-order-btn:hover { background-color: #45a049; }
        .close-order-btn { flex: 1; padding: 15px; background-color: #ccc; color: #333; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <header class="top-nav">
        <span id="currentTableDisplay">ğŸ”¥ å°šæœªé€‰æ¡Œ</span>
        <div class="right-buttons">
            <button id="editMenuBtn">ç¼–è¾‘èœå•</button>
            <button id="incomeSummaryBtn">æ”¶å…¥æ±‡æ€»</button>
            <button id="purchaseManageBtn">é‡‡è´­ç®¡ç†</button>
        </div>
    </header>

    <main class="menu-container">
        </main>

    <footer class="bottom-bar">
        <div class="total-display">
            æ€»è®¡: <span id="totalPrice">0 Ks</span> (<span id="orderCount">0 ä»½</span>)
        </div>
        <button class="view-order-btn" id="viewOrderBtn">æŸ¥çœ‹/ç»“ç®—</button>
    </footer>

    <div id="tableModal" class="modal">
        <div class="modal-content">
            <h2>è¯·é€‰æ‹©æ¡Œå·</h2>
            <div id="tableGrid" class="table-grid">
                </div>
            <button id="closeModalBtn" class="close-btn">å…³é—­</button>
        </div>
    </div>
    
    <div id="orderModal" class="modal">
        <div class="order-modal-content">
            <div class="order-header">
                <span class="order-title" id="orderModalTitle">æ¡Œå·: N/A</span>
            </div>
            <div class="order-hr"></div>
            
            <div class="order-content" id="orderDetailsContent">
                </div>
            
            <div class="order-total-display" id="orderModalTotal">æ€»è®¡: 0 Ks</div>
            
            <div class="order-actions">
                <button class="checkout-order-btn" id="checkoutOrderBtn">âœ… ç»“ç®—å¹¶æ¸…ç©º</button>
                <button class="clear-order-btn" id="clearOrderBtn">ğŸ—‘ï¸ æ¸…ç©ºç‚¹å•</button>
                <button class="close-order-btn" id="orderCloseBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>


    <script>
        // --- å­˜å‚¨é”® ---
        const MENU_STORAGE_KEY = 'grill_menu_data';
        const ORDERS_STORAGE_KEY = 'grill_table_orders';
        const INCOME_STORAGE_KEY = 'grill_income_data';
        const DEFAULT_MENU_ITEMS = [
            { uniqueId: 'default1', name: 'ç¾Šè‚‰', price: 2000, category: 'è‚‰ç±»' },
            { uniqueId: 'default2', name: 'ç‰›è‚‰', price: 2500, category: 'è‚‰ç±»' },
            { uniqueId: 'default3', name: 'é¸¡ç¿…', price: 3000, category: 'è‚‰ç±»' },
            { uniqueId: 'default4', name: 'çƒ¤é±¼', price: 5000, category: 'æµ·é²œ/æ°´äº§' },
            { uniqueId: 'default5', name: 'çƒ¤è™¾', price: 4000, category: 'æµ·é²œ/æ°´äº§' },
            { uniqueId: 'default6', name: 'ç‰ç±³', price: 1000, category: 'è”¬èœ/ç´ èœ' },
            { uniqueId: 'default7', name: 'èŒ„å­', price: 1500, category: 'è”¬èœ/ç´ èœ' },
            { uniqueId: 'default8', name: 'å¯ä¹', price: 500, category: 'é¥®å“' },
        ];

        // --- å­˜å‚¨æ“ä½œ ---
        function loadTableOrders() {
            const storedOrders = localStorage.getItem(ORDERS_STORAGE_KEY);
            if (storedOrders) {
                try {
                    const obj = JSON.parse(storedOrders);
                    return new Map(Object.entries(obj));
                } catch (e) {
                    console.error("Failed to parse table orders:", e);
                }
            }
            return new Map();
        }

        function saveTableOrders(ordersMap) {
            const obj = Object.fromEntries(ordersMap);
            localStorage.setItem(ORDERS_STORAGE_KEY, JSON.stringify(obj));
        }

        function getLatestMenuStructure() {
            const storedData = localStorage.getItem(MENU_STORAGE_KEY);
            if (storedData) {
                try {
                    const menuItems = JSON.parse(storedData);
                    // ç¡®ä¿èœå•é¡¹åŒ…å« quantity å­—æ®µï¼Œå¹¶ä½¿ç”¨ uniqueId ä½œä¸º item.id
                    return menuItems.map(item => ({ 
                        id: (item.uniqueId || item.id).toString(), 
                        name: item.name, 
                        price: parseInt(item.price) || 0, 
                        category: item.category, 
                        quantity: 0 
                    }));
                } catch (e) {
                    console.error("Failed to parse menu data from localStorage:", e);
                }
            }
            // é»˜è®¤èœå•æ•°æ®ï¼ˆå¦‚æœèœå•ä¸ºç©ºï¼‰
            return DEFAULT_MENU_ITEMS.map(item => ({ 
                id: item.uniqueId.toString(), 
                name: item.name, 
                price: item.price, 
                category: item.category, 
                quantity: 0 
            }));
        }
        
        // --- å…¨å±€å˜é‡ ---
        let currentTableNumber = null;
        const totalTableCount = 12;
        const tableOrders = loadTableOrders(); // Map<string, MenuItem[]>
        const menuContainer = document.querySelector('.menu-container');
        const totalPriceElement = document.getElementById('totalPrice');
        const orderCountElement = document.getElementById('orderCount');
        
        const tableModal = document.getElementById('tableModal');
        const orderModal = document.getElementById('orderModal');
        const currentTableDisplay = document.getElementById('currentTableDisplay');
        const orderModalTitle = document.getElementById('orderModalTitle');
        const orderDetailsContent = document.getElementById('orderDetailsContent');
        const orderModalTotal = document.getElementById('orderModalTotal');
        const clearOrderBtn = document.getElementById('clearOrderBtn');
        const checkoutOrderBtn = document.getElementById('checkoutOrderBtn');
        const orderCloseBtn = document.getElementById('orderCloseBtn');

        // --- æ ¸å¿ƒé€»è¾‘ ---

        /**
         * ä»å½“å‰æ¡Œè®¢å•ä¸­æŸ¥æ‰¾èœå“
         * @param {string} id èœå“ID
         * @returns {object | null} èœå“å¯¹è±¡æˆ– null
         */
        function findItemInCurrentOrder(id) {
            if (currentTableNumber === null) return null;
            const tableKey = currentTableNumber.toString();
            const order = tableOrders.get(tableKey);
            if (order) {
                return order.find(item => item.id === id);
            }
            return null;
        }

        function calculateOrderTotal(order) {
            return order.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function calculateTotalQuantity(order) {
            return order.reduce((total, item) => total + item.quantity, 0);
        }

        function updateTotals() {
            if (currentTableNumber === null) {
                totalPriceElement.textContent = '0 Ks';
                orderCountElement.textContent = '0 ä»½';
                currentTableDisplay.textContent = 'ğŸ”¥ å°šæœªé€‰æ¡Œ';
                return;
            }

            const tableKey = currentTableNumber.toString();
            const order = tableOrders.get(tableKey);
            
            if (order) {
                const total = calculateOrderTotal(order);
                const quantity = calculateTotalQuantity(order);
                totalPriceElement.textContent = `${total.toLocaleString()} Ks`;
                orderCountElement.textContent = `${quantity.toLocaleString()} ä»½`;
            } else {
                // å¦‚æœæ¡Œå·å­˜åœ¨ä½†è®¢å•è¢«æ¸…ç©ºäº†
                totalPriceElement.textContent = '0 Ks';
                orderCountElement.textContent = '0 ä»½';
            }
            currentTableDisplay.textContent = `âœ… ${currentTableNumber}å·æ¡Œ`;
        }

        function renderMenu() {
            menuContainer.innerHTML = '';
            const menuStructure = getLatestMenuStructure();
            
            // å¦‚æœå·²é€‰æ¡Œå·ï¼Œåˆ™è·å–å½“å‰æ¡Œçš„è®¢å•çŠ¶æ€
            let currentOrder = [];
            if (currentTableNumber !== null && tableOrders.has(currentTableNumber.toString())) {
                currentOrder = tableOrders.get(currentTableNumber.toString());
            }

            // å°†èœå•é¡¹æŒ‰åˆ†ç±»åˆ†ç»„
            const categorizedItems = menuStructure.reduce((acc, item) => {
                const categoryKey = item.category || 'å…¶ä»–';
                // ä½¿ç”¨èœå•ç»“æ„ä½œä¸ºåŸºç¡€ï¼Œä½†ç”¨å½“å‰è®¢å•ä¸­çš„æ•°é‡è¦†ç›–
                const orderItem = currentOrder.find(o => o.id === item.id);
                const finalItem = {...item, quantity: orderItem ? orderItem.quantity : 0};
                
                if (!acc[categoryKey]) {
                    acc[categoryKey] = [];
                }
                acc[categoryKey].push(finalItem);
                return acc;
            }, {});

            // æ¸²æŸ“èœå•
            for (const category in categorizedItems) {
                // æ¸²æŸ“åˆ†ç±»å¤´éƒ¨
                const header = document.createElement('div');
                header.className = 'category-header';
                header.textContent = category;
                menuContainer.appendChild(header);

                // æ¸²æŸ“åˆ†ç±»ä¸‹çš„èœå“
                categorizedItems[category].forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'menu-item';
                    const itemId = item.id;
                    itemElement.dataset.id = itemId;

                    const infoHTML = `
                        <div class="item-info">
                            <div class="name">${item.name}</div>
                            <div class="price">ä»·æ ¼: ${item.price.toLocaleString()} Ks</div>
                        </div>
                    `;

                    const controlClass = item.quantity === 0 ? 'quantity-control hidden' : 'quantity-control';
                    const controlHTML = `
                        <div class="${controlClass}">
                            <button class="control-btn minus-btn" data-id="${itemId}">-</button>
                            <div class="quantity" data-id="${itemId}">${item.quantity}</div>
                            <button class="control-btn add add-btn" data-id="${itemId}">+</button>
                        </div>
                    `;
                    
                    itemElement.innerHTML = infoHTML + controlHTML;
                    menuContainer.appendChild(itemElement);
                });
            }

            bindMenuButtons();
            updateTotals();
            updateTableStatus();
        }

        function bindMenuButtons() {
            document.querySelectorAll('.add-btn').forEach(btn => {
                btn.onclick = (e) => updateQuantity(e.currentTarget.dataset.id, 1);
            });
            document.querySelectorAll('.minus-btn').forEach(btn => {
                btn.onclick = (e) => updateQuantity(e.currentTarget.dataset.id, -1);
            });
        }

        function updateQuantity(id, change) {
            if (currentTableNumber === null) {
                alert('è¯·å…ˆé€‰æ‹©æ¡Œå·æ‰èƒ½ç‚¹èœï¼');
                renderTableGrid();
                showModal(tableModal);
                return;
            }

            const tableKey = currentTableNumber.toString();
            // ç¡®ä¿å½“å‰æ¡Œå·æœ‰è®¢å•å¯¹è±¡
            if (!tableOrders.has(tableKey)) {
                // å¦‚æœæ˜¯æ–°è®¢å•ï¼Œä»æœ€æ–°èœå•ç»“æ„åˆå§‹åŒ–ä¸€ä¸ª
                const initialOrder = getLatestMenuStructure();
                tableOrders.set(tableKey, initialOrder);
            }

            const order = tableOrders.get(tableKey);
            const item = order.find(i => i.id === id);

            if (!item) return;

            item.quantity = Math.max(0, item.quantity + change);

            const quantityElement = document.querySelector(`.quantity[data-id="${id}"]`);
            const controlContainer = quantityElement ? quantityElement.closest('.quantity-control') : null;

            if (quantityElement && controlContainer) {
                quantityElement.textContent = item.quantity;
                if (item.quantity > 0) {
                    controlContainer.classList.remove('hidden');
                } else {
                    controlContainer.classList.add('hidden');
                }
            }

            updateTotals();
            updateTableStatus();
            saveTableOrders(tableOrders);
        }
        
        function renderTableGrid() {
            const tableGrid = document.getElementById('tableGrid');
            tableGrid.innerHTML = '';
            
            for (let i = 1; i <= totalTableCount; i++) {
                const tableKey = i.toString();
                const isOccupied = tableOrders.has(tableKey) && calculateOrderTotal(tableOrders.get(tableKey)) > 0;
                const isSelected = currentTableNumber === i;

                const btn = document.createElement('button');
                btn.textContent = `${i} å·æ¡Œ`;
                btn.className = 'table-number-btn';
                btn.classList.toggle('occupied', isOccupied);
                btn.classList.toggle('selected', isSelected);
                btn.dataset.tableNumber = i;
                
                btn.onclick = () => selectTable(i);
                tableGrid.appendChild(btn);
            }
        }

        function updateTableStatus() {
            // æ›´æ–°èœå•é¡¹çš„æ˜¾ç¤ºçŠ¶æ€
            document.querySelectorAll('.menu-item').forEach(itemElement => {
                const itemId = itemElement.dataset.id;
                const item = findItemInCurrentOrder(itemId);

                const quantityElement = itemElement.querySelector(`.quantity[data-id="${itemId}"]`);
                const controlContainer = quantityElement ? quantityElement.closest('.quantity-control') : null;

                if (item && quantityElement && controlContainer) {
                    quantityElement.textContent = item.quantity;
                    if (item.quantity > 0) {
                        controlContainer.classList.remove('hidden');
                    } else {
                        controlContainer.classList.add('hidden');
                    }
                }
            });
            
            // æ›´æ–°é¡¶éƒ¨æ¡Œå·æ˜¾ç¤º
            if (currentTableNumber !== null) {
                currentTableDisplay.textContent = `âœ… ${currentTableNumber}å·æ¡Œ`;
            } else {
                currentTableDisplay.textContent = 'ğŸ”¥ å°šæœªé€‰æ¡Œ';
            }
        }

        function selectTable(tableNumber) {
            if (currentTableNumber !== tableNumber) {
                currentTableNumber = tableNumber;
                // é‡æ–°æ¸²æŸ“èœå•ä»¥æ˜¾ç¤ºæ–°æ¡Œå·çš„è®¢å•çŠ¶æ€
                renderMenu(); 
            }
            hideModal(tableModal);
            updateTotals();
        }

        function renderOrderDetails() {
            if (currentTableNumber === null) return;
            const tableKey = currentTableNumber.toString();
            const order = tableOrders.get(tableKey);
            
            orderModalTitle.textContent = `è®¢å•è¯¦æƒ… - ${currentTableNumber}å·æ¡Œ`;
            
            if (!order || calculateOrderTotal(order) === 0) {
                orderDetailsContent.innerHTML = '<div class="no-order-text">è¯¥æ¡Œå½“å‰æ²¡æœ‰ç‚¹å•ã€‚</div>';
                orderModalTotal.textContent = 'æ€»è®¡: 0 Ks';
                checkoutOrderBtn.disabled = true;
                clearOrderBtn.disabled = true;
            } else {
                const activeItems = order.filter(item => item.quantity > 0);
                let html = '';
                activeItems.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    html += `
                        <div class="order-item">
                            <span class="item-name-qty">${item.name} x ${item.quantity}</span>
                            <span class="item-subtotal">${subtotal.toLocaleString()} Ks</span>
                        </div>
                    `;
                });
                orderDetailsContent.innerHTML = html;
                const total = calculateOrderTotal(order);
                orderModalTotal.textContent = `æ€»è®¡: ${total.toLocaleString()} Ks`;
                checkoutOrderBtn.disabled = false;
                clearOrderBtn.disabled = false;
            }
            showModal(orderModal);
        }

        // --- æ”¶å…¥é€»è¾‘ ---
        function loadIncomeData() {
             const storedData = localStorage.getItem(INCOME_STORAGE_KEY);
             if (storedData) {
                 try {
                     return JSON.parse(storedData);
                 } catch (e) {
                     console.error("Failed to parse income data:", e);
                 }
             }
             return { total: 0, closedOrders: [] };
        }

        function saveIncomeData(incomeData) {
             localStorage.setItem(INCOME_STORAGE_KEY, JSON.stringify(incomeData));
        }

        function recordIncome(order, total) {
            const incomeData = loadIncomeData();
            
            // è®°å½•è®¢å•è¯¦æƒ…
            const itemsToSave = order
                .filter(item => item.quantity > 0)
                .map(item => ({ 
                    name: item.name, 
                    quantity: item.quantity, 
                    price: item.price // è®°å½•å•ä»·
                }));

            incomeData.total += total;
            incomeData.closedOrders.push({
                table: currentTableNumber,
                amount: total,
                time: new Date().toLocaleString(),
                items: itemsToSave
            });
            
            saveIncomeData(incomeData);
        }

        /**
         * ç»“ç®—å¹¶æ¸…ç©ºå½“å‰æ¡Œè®¢å•
         */
        function resetOrder() {
            if (!currentTableNumber) return;
            const tableKey = currentTableNumber.toString();
            const order = tableOrders.get(tableKey);
            const total = calculateOrderTotal(order);

            if (!order || total === 0) {
                 if (tableOrders.has(tableKey)) {
                     tableOrders.delete(tableKey); // æ¸…ç©ºç©ºè®¢å•
                 }
                 alert(`âœ… ${currentTableNumber}å·æ¡Œè®¢å•å·²æ¸…ç©ºã€‚`);
            } 
            
            else if (!confirm(`ç¡®å®šç»“ç®—å¹¶æ¸…ç©º ${currentTableNumber}å·æ¡Œçš„è®¢å•å—ï¼Ÿ\næ€»é‡‘é¢: ${total.toLocaleString()} Ks\næ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                 return;
            } else {
                 // 1. è®°å½•æ”¶å…¥
                 recordIncome(order, total);
                 
                 // 2. æ¸…ç©ºè®¢å•
                 tableOrders.delete(tableKey);
                 
                 // 3. æ›´æ–°UI
                 updateTotals();
                 renderMenu();
                 hideModal(orderModal);
                 alert(`âœ… ${currentTableNumber}å·æ¡Œå·²ç»“ç®—ï¼Œæ”¶å…¥ ${total.toLocaleString()} Ks å·²è®°å½•ã€‚`);
            }
            
            saveTableOrders(tableOrders);
            // é‡æ–°æ¸²æŸ“æ¡Œå·ç½‘æ ¼ä»¥æ›´æ–°å ç”¨çŠ¶æ€
            renderTableGrid();
        }

        // --- äº‹ä»¶ç»‘å®š ---
        function bindEventListeners() {
            const selectTableBtn = document.getElementById('currentTableDisplay');
            if (selectTableBtn) {
                selectTableBtn.onclick = () => {
                    renderTableGrid();
                    showModal(tableModal);
                };
            }
            
            // ************ ä¿®å¤åŒºåŸŸ START ************
            const editMenuBtn = document.getElementById('editMenuBtn');
            const incomeSummaryBtn = document.getElementById('incomeSummaryBtn');
            const purchaseManageBtn = document.getElementById('purchaseManageBtn');

            // ä½¿ç”¨æ–°çš„è‹±æ–‡æ–‡ä»¶åè¿›è¡Œè·³è½¬ï¼Œè§£å†³ GitHub Pages é“¾æ¥é”™è¯¯
            if (editMenuBtn) { 
                editMenuBtn.onclick = () => window.location.href = 'menu_edit.html';
            }
            if (incomeSummaryBtn) { 
                incomeSummaryBtn.onclick = () => window.location.href = 'income_summary.html';
            }
            if (purchaseManageBtn) { 
                purchaseManageBtn.onclick = () => window.location.href = 'purchase_manage.html';
            }
            // ************ ä¿®å¤åŒºåŸŸ END ************

            const viewOrderBtn = document.getElementById('viewOrderBtn');
            if (viewOrderBtn) {
                viewOrderBtn.onclick = () => {
                    if (currentTableNumber === null) {
                        alert('è¯·å…ˆé€‰æ‹©æ¡Œå·ï¼');
                        renderTableGrid();
                        showModal(tableModal);
                        return;
                    }
                    renderOrderDetails();
                };
            }

            if (clearOrderBtn) { clearOrderBtn.onclick = () => {
                 if (confirm(`ç¡®å®šè¦æ¸…ç©º ${currentTableNumber}å·æ¡Œå½“å‰çš„ç‚¹å•å—ï¼Ÿ`)) {
                    // æ¸…ç©ºè®¢å• (ä¸è®°å½•æ”¶å…¥)
                    tableOrders.delete(currentTableNumber.toString());
                    saveTableOrders(tableOrders);
                    updateTotals();
                    renderMenu();
                    hideModal(orderModal);
                    alert(`ğŸ—‘ï¸ ${currentTableNumber}å·æ¡Œç‚¹å•å·²æ¸…ç©ºã€‚`);
                 }
            }; }
            if (checkoutOrderBtn) { checkoutOrderBtn.onclick = resetOrder; }
            if (orderCloseBtn) { orderCloseBtn.onclick = () => hideModal(orderModal); }
            
            const closeModalBtn = document.getElementById('closeModalBtn');
            if (closeModalBtn) {
                closeModalBtn.onclick = () => hideModal(tableModal);
            }
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            window.onclick = function(event) {
                if (event.target == tableModal) {
                    hideModal(tableModal);
                }
                if (event.target == orderModal) {
                    hideModal(orderModal);
                }
            }
        }
        
        function showModal(modalElement) { modalElement.style.display = 'flex'; }
        function hideModal(modalElement) { modalElement.style.display = 'none'; }


        // é¡µé¢å¯åŠ¨
        renderMenu();
        bindEventListeners();
    </script>
</body>
</html>
