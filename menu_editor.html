<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚙️ 菜单管理中心 (本地存储)</title>
    
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h2 { color: #a04000; border-bottom: 2px solid #ff9933; padding-bottom: 5px; margin-top: 0; }
        
        /* 表单布局 */
        .control-group { margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; }
        .control-group input, .control-group select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; flex-grow: 1; min-width: 120px; }
        .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #add-menu-item-btn { background-color: #5cb85c; color: white; flex-grow: 0; }
        #add-menu-item-btn:hover { background-color: #4cae4c; }

        /* 列表展示 */
        .category-group { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .category-group h4 { margin-top: 0; color: #a04000; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        #menu-list { list-style: none; padding: 0; margin-top: 0; }
        .menu-item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #eee; }
        .menu-item-row:last-child { border-bottom: none; }
        .menu-item-row span { flex-grow: 1; }
        .delete-btn { background-color: #d9534f; color: white; margin-left: 10px; }
        .delete-btn:hover { background-color: #c9302c; }
    </style>
</head>
<body>

    <div class="container">
        <h2>⚙️ 菜单管理中心</h2>
        
        <h3>添加新菜单项</h3>
        <div class="control-group">
            <input type="text" id="new-item-name" placeholder="菜单名称 (如：土豆片)">
            <input type="number" id="new-item-price" placeholder="价格 (Ks)" step="1">
            <input type="text" id="new-item-category" placeholder="分类 (如：肉类/素菜)">
            <button id="add-menu-item-btn" class="btn">添加</button>
        </div>
        <p id="menu-message" style="color:red; margin-top: 5px;"></p>

        <h3>当前菜单列表 (按分类)</h3>
        <div id="menu-list">
            <p>加载中...</p>
        </div>
        
        <hr style="margin-top: 20px;">
        <p>
            <a href="index.html">返回订单系统</a>
        </p>
    </div>

    <script>
        const MENU_KEY = 'bbq_menu_items';
        let menuItems = [];

        const nameInput = document.getElementById('new-item-name');
        const priceInput = document.getElementById('new-item-price');
        const categoryInput = document.getElementById('new-item-category');
        const addButton = document.getElementById('add-menu-item-btn');
        const menuListContainer = document.getElementById('menu-list');
        const menuMessage = document.getElementById('menu-message');

        // --- LocalStorage 数据读写函数 ---
        
        function loadMenuItems() {
            try {
                const data = localStorage.getItem(MENU_KEY);
                menuItems = data ? JSON.parse(data) : [];
                renderMenuList();
            } catch (e) {
                console.error("加载菜单失败:", e);
                menuListContainer.innerHTML = `<p style="color: red;">本地存储加载失败。</p>`;
            }
        }

        function saveMenuItems() {
            localStorage.setItem(MENU_KEY, JSON.stringify(menuItems));
        }

        // --- 核心操作函数 ---

        function renderMenuList() {
            menuListContainer.innerHTML = '';
            
            const categorizedItems = menuItems.reduce((acc, item) => {
                const category = item.category || '未分类';
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(item);
                return acc;
            }, {});

            const categories = Object.keys(categorizedItems).sort();
            
            if (categories.length === 0) {
                menuListContainer.innerHTML = `<p style="text-align: center; color: #888;">暂无菜单项。</p>`;
                return;
            }

            categories.forEach(category => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'category-group';
                
                groupDiv.innerHTML = `<h4>${category}</h4><ul class="menu-list-ul"></ul>`;
                const ul = groupDiv.querySelector('.menu-list-ul');

                // 按 ID 排序，确保新添加的在后面
                categorizedItems[category].sort((a, b) => a.id - b.id).forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'menu-item-row';
                    li.innerHTML = `
                        <span>${item.name} (${item.price.toFixed(0)} Ks)</span>
                        <button data-id="${item.id}" class="btn delete-btn">删除</button>
                    `;
                    ul.appendChild(li);
                });
                
                menuListContainer.appendChild(groupDiv);
            });

            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.dataset.id); 
                    deleteMenuItem(id);
                });
            });
        }

        function deleteMenuItem(id) {
            menuItems = menuItems.filter(item => item.id !== id);
            saveMenuItems();
            renderMenuList();
            menuMessage.textContent = '菜单项已删除。';
            menuMessage.style.color = 'green';
        }

        function addNewMenuItem() {
            const name = nameInput.value.trim();
            const price = parseFloat(priceInput.value);
            const category = categoryInput.value.trim() || '未分类'; 

            menuMessage.textContent = ''; 
            menuMessage.style.color = 'red';

            if (!name) { menuMessage.textContent = '请输入菜单名称。'; return; }
            if (isNaN(price) || price <= 0) { menuMessage.textContent = '请输入有效的价格。'; return; }
            if (menuItems.some(item => item.name === name)) { menuMessage.textContent = `菜单中已存在"${name}"。`; return; }
            
            // 找到下一个可用的 ID
            const newId = menuItems.length > 0 ? Math.max(...menuItems.map(item => item.id)) + 1 : 1;

            const newItem = {
                id: newId,
                name: name,
                price: price,
                category: category 
            };
            
            menuItems.push(newItem);
            saveMenuItems();

            // 清空输入框并更新列表
            nameInput.value = '';
            priceInput.value = '';
            categoryInput.value = ''; 
            renderMenuList();
            
            menuMessage.textContent = `成功添加: ${name} (${price.toFixed(0)} Ks) [分类: ${category}]`;
            menuMessage.style.color = 'green';
        }

        // --- 初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            loadMenuItems(); 
            addButton.addEventListener('click', addNewMenuItem);
        });
    </script>
</body>

</html>
